
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeCanvas - Ultimate Ideation Studio</title>
    <style>
        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --bg-hover: #30363d;
            --border-primary: #30363d;
            --border-secondary: #21262d;
            --text-primary: #c9d1d9;
            --text-secondary: #8b949e;
            --text-tertiary: #58a6ff;
            --accent-primary: #58a6ff;
            --accent-secondary: #1f6feb;
            --accent-success: #3fb950;
            --accent-warning: #d29922;
            --accent-danger: #f85149;
            --shadow-sm: 0 1px 0 rgba(27,31,35,0.04);
            --shadow-md: 0 3px 6px rgba(0,0,0,0.3);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.4);
            --transition: all 0.2s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans", Helvetica, Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow: hidden;
            height: 100vh;
            user-select: none;
        }

        .app-container {
            display: flex;
            height: 100vh;
            position: relative;
        }

        /* Header */
        .header {
            height: 50px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-primary);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 100;
            box-shadow: var(--shadow-sm);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            font-size: 18px;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .logo-icon {
            font-size: 24px;
        }

        .header-actions {
            display: flex;
            gap: 10px;
        }

        /* Toolbar */
        .toolbar {
            width: 60px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-primary);
            display: flex;
            flex-direction: column;
            padding: 10px 0;
            z-index: 100;
            box-shadow: var(--shadow-md);
        }

        .tool-btn {
            width: 44px;
            height: 44px;
            margin: 4px auto;
            background: var(--bg-tertiary);
            border: 2px solid transparent;
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            position: relative;
        }

        .tool-btn:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .tool-btn.active {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-secondary);
            box-shadow: 0 0 12px rgba(88, 166, 255, 0.4);
        }

        .tool-btn svg {
            width: 20px;
            height: 20px;
        }

        .tooltip {
            position: absolute;
            left: 100%;
            margin-left: 10px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            z-index: 1000;
            box-shadow: var(--shadow-lg);
        }

        .tool-btn:hover .tooltip {
            opacity: 1;
        }

        .toolbar-divider {
            height: 1px;
            background: var(--border-primary);
            margin: 8px 10px;
        }

        /* Properties Panel */
        .properties-panel {
            width: 280px;
            background: var(--bg-secondary);
            border-left: 1px solid var(--border-primary);
            padding: 20px;
            overflow-y: auto;
            z-index: 100;
            transition: transform 0.3s ease;
            box-shadow: var(--shadow-md);
        }

        .property-group {
            margin-bottom: 20px;
        }

        .property-label {
            display: block;
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .property-input {
            width: 100%;
            padding: 8px 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-primary);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 14px;
            transition: var(--transition);
        }

        .property-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1);
        }

        .property-input[type="range"] {
            padding: 4px 0;
        }

        .color-picker-wrapper {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .color-swatch {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: var(--transition);
        }

        .color-swatch:hover {
            transform: scale(1.1);
            border-color: var(--text-primary);
        }

        .color-swatch.active {
            border-color: var(--accent-primary);
            box-shadow: 0 0 8px rgba(88, 166, 255, 0.4);
        }

        /* Canvas Area */
        .canvas-container {
            flex: 1;
            position: relative;
            background: var(--bg-primary);
            overflow: hidden;
        }

        .canvas {
            position: absolute;
            width: 5000px;
            height: 5000px;
            background-image: 
                linear-gradient(var(--border-secondary) 1px, transparent 1px),
                linear-gradient(90deg, var(--border-secondary) 1px, transparent 1px);
            background-size: 20px 20px;
            transform-origin: center center;
        }

        .canvas.no-grid {
            background-image: none;
        }

        /* Zoom Controls */
        .zoom-controls {
            position: absolute;
            bottom: 20px;
            right: 300px;
            display: flex;
            gap: 8px;
            background: var(--bg-secondary);
            padding: 8px;
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
        }

        .zoom-btn {
            width: 32px;
            height: 32px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-primary);
            border-radius: 6px;
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .zoom-btn:hover {
            background: var(--bg-hover);
        }

        .zoom-level {
            min-width: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Canvas Elements */
        .canvas-element {
            position: absolute;
            cursor: move;
        }

        .canvas-element.selected {
            outline: 2px solid var(--accent-primary);
            outline-offset: 2px;
        }

        .text-element {
            padding: 10px;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-family: inherit;
            resize: none;
            outline: none;
            min-width: 100px;
            min-height: 30px;
        }

        .code-element {
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            border-radius: 8px;
            padding: 15px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            white-space: pre;
            overflow: auto;
            min-width: 200px;
            min-height: 100px;
        }

        .shape-element {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Buttons */
        .btn {
            padding: 8px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-primary);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 13px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn:hover {
            background: var(--bg-hover);
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        .btn-primary {
            background: var(--accent-primary);
            border-color: var(--accent-secondary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent-secondary);
        }

        /* Status Bar */
        .status-bar {
            position: absolute;
            bottom: 0;
            left: 60px;
            right: 280px;
            height: 24px;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-primary);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            font-size: 12px;
            color: var(--text-secondary);
            z-index: 99;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }

        .modal-header {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-primary);
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .project-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--border-primary);
            border-radius: 8px;
            background: var(--bg-tertiary);
        }

        .project-item {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border-primary);
            cursor: pointer;
            transition: background 0.2s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .project-item:hover {
            background: var(--bg-hover);
        }

        .project-item:last-child {
            border-bottom: none;
        }

        .project-date {
            font-size: 11px;
            color: var(--text-secondary);
        }

        /* Floating Action Button */
        .fab {
            position: fixed;
            bottom: 30px;
            left: 80px;
            width: 56px;
            height: 56px;
            background: var(--accent-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            box-shadow: var(--shadow-lg);
            cursor: pointer;
            transition: var(--transition);
            z-index: 100;
        }

        .fab:hover {
            transform: scale(1.1) rotate(90deg);
            background: var(--accent-secondary);
            box-shadow: 0 0 20px rgba(88, 166, 255, 0.6);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.3s ease;
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-primary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        /* Context Menu */
        .context-menu {
            position: absolute;
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            border-radius: 6px;
            padding: 8px 0;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            display: none;
        }

        .context-menu-item {
            padding: 8px 15px;
            cursor: pointer;
            font-size: 13px;
            color: var(--text-primary);
            transition: background 0.2s;
        }

        .context-menu-item:hover {
            background: var(--bg-hover);
        }

        /* Welcome Screen */
        .welcome-screen {
            position: absolute;
            top: 50px;
            left: 60px;
            right: 280px;
            bottom: 24px;
            background: var(--bg-primary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .welcome-content {
            max-width: 500px;
            text-align: center;
            padding: 40px;
        }

        .welcome-title {
            font-size: 28px;
            margin-bottom: 20px;
            color: var(--text-primary);
        }

        .welcome-subtitle {
            font-size: 16px;
            color: var(--text-secondary);
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .welcome-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 40px;
        }

        .template-item {
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: var(--transition);
        }

        .template-item:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .template-title {
            font-size: 16px;
            margin-bottom: 10px;
            color: var(--text-primary);
        }

        .template-desc {
            font-size: 13px;
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                <span class="logo-icon">&#9998;</span>
                <span>CodeCanvas</span>
            </div>
            <div class="header-actions">
                <button class="btn" id="newProjectBtn">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"/>
                        <line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                    New
                </button>
                <button class="btn" id="saveProjectBtn">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/>
                        <polyline points="17 21 17 13 7 13 7 21"/>
                        <polyline points="7 3 7 8 15 8"/>
                    </svg>
                    Save
                </button>
                <button class="btn" id="openProjectBtn">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/>
                    </svg>
                    Open
                </button>
                <button class="btn btn-primary" id="exportBtn">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    Export
                </button>
            </div>
        </div>

        <!-- Toolbar -->
        <div class="toolbar">
            <button class="tool-btn active" data-tool="select">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 3l7.07 16.97 2.51-7.39 7.39-2.51L3 3z"/>
                </svg>
                <span class="tooltip">Select Tool (V)</span>
            </button>
            <button class="tool-btn" data-tool="brush">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z"/>
                </svg>
                <span class="tooltip">Brush Tool (B)</span>
            </button>
            <button class="tool-btn" data-tool="eraser">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 21H9l-7-7a2 2 0 010-2.83l10-10a2 2 0 012.83 0l7 7a2 2 0 010 2.83L13 21"/>
                </svg>
                <span class="tooltip">Eraser Tool (E)</span>
            </button>
            <button class="tool-btn" data-tool="text">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M13 4h-2v16h2M6 20h12M6 4h12"/>
                </svg>
                <span class="tooltip">Text Tool (T)</span>
            </button>
            <button class="tool-btn" data-tool="shape">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2"/>
                </svg>
                <span class="tooltip">Shape Tool (S)</span>
            </button>
            <button class="tool-btn" data-tool="connector">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 11L3 17l6 6 6-6-6-6zM21 3l-6 6 6 6"/>
                </svg>
                <span class="tooltip">Connector Tool (C)</span>
            </button>
            <button class="tool-btn" data-tool="code">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="16 18 22 12 16 6"/>
                    <polyline points="8 6 2 12 8 18"/>
                </svg>
                <span class="tooltip">Code Snippet</span>
            </button>
            <div class="toolbar-divider"></div>
            <button class="tool-btn" id="undoBtn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 7v6h6"/>
                    <path d="M21 17a9 9 0 00-9-9 9 9 0 00-6 2.3L3 13"/>
                </svg>
                <span class="tooltip">Undo (Ctrl+Z)</span>
            </button>
            <button class="tool-btn" id="redoBtn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 7v6h-6"/>
                    <path d="M3 17a9 9 0 019-9 9 9 0 016 2.3L21 13"/>
                </svg>
                <span class="tooltip">Redo (Ctrl+Y)</span>
            </button>
            <button class="tool-btn" id="gridToggle">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="6" height="6"/>
                    <rect x="15" y="3" width="6" height="6"/>
                    <rect x="3" y="15" width="6" height="6"/>
                    <rect x="15" y="15" width="6" height="6"/>
                </svg>
                <span class="tooltip">Toggle Grid</span>
            </button>
        </div>

        <!-- Canvas Container -->
        <div class="canvas-container">
            <!-- Welcome Screen -->
            <div class="welcome-screen" id="welcomeScreen">
                <div class="welcome-content">
                    <h1 class="welcome-title">Welcome to CodeCanvas</h1>
                    <p class="welcome-subtitle">
                        Your all-in-one ideation studio for developers, designers, and creators.
                        Start with a blank canvas or choose from one of our templates.
                    </p>
                    <div class="welcome-actions">
                        <button class="btn btn-primary" id="startBlankBtn">
                            Start with Blank Canvas
                        </button>
                        <button class="btn" id="viewTemplatesBtn">
                            View Templates
                        </button>
                    </div>
                    <div class="template-grid" id="templateGrid" style="display: none;">
                        <div class="template-item" data-template="flowchart">
                            <h3 class="template-title">Flowchart</h3>
                            <p class="template-desc">Create algorithm and process flowcharts</p>
                        </div>
                        <div class="template-item" data-template="wireframe">
                            <h3 class="template-title">Wireframe</h3>
                            <p class="template-desc">Design UI mockups and layouts</p>
                        </div>
                        <div class="template-item" data-template="mindmap">
                            <h3 class="template-title">Mind Map</h3>
                            <p class="template-desc">Organize ideas and concepts visually</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Canvas -->
            <div class="canvas" id="canvas"></div>

            <!-- Zoom Controls -->
            <div class="zoom-controls">
                <button class="zoom-btn" id="zoomOut">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                </button>
                <div class="zoom-level" id="zoomLevel">100%</div>
                <button class="zoom-btn" id="zoomIn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"/>
                        <line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                </button>
                <button class="zoom-btn" id="zoomReset">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="M21 21l-4.35-4.35"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Properties Panel -->
        <div class="properties-panel" id="propertiesPanel">
            <h3 style="margin-bottom: 20px; font-size: 16px; font-weight: 600;">Properties</h3>
            
            <!-- Brush Properties -->
            <div id="brushProperties">
                <div class="property-group">
                    <label class="property-label">Brush Color</label>
                    <div class="color-picker-wrapper">
                        <div class="color-swatch active" style="background: #ffffff;" data-color="#ffffff"></div>
                        <div class="color-swatch" style="background: #f85149;" data-color="#f85149"></div>
                        <div class="color-swatch" style="background: #3fb950;" data-color="#3fb950"></div>
                        <div class="color-swatch" style="background: #58a6ff;" data-color="#58a6ff"></div>
                        <div class="color-swatch" style="background: #d29922;" data-color="#d29922"></div>
                        <div class="color-swatch" style="background: #a371f7;" data-color="#a371f7"></div>
                    </div>
                </div>
                <div class="property-group">
                    <label class="property-label">Brush Size</label>
                    <input type="range" class="property-input" id="brushSize" min="1" max="20" value="3">
                    <div style="text-align: center; margin-top: 5px; font-size: 12px; color: var(--text-secondary);">
                        <span id="brushSizeValue">3</span>px
                    </div>
                </div>
                <div class="property-group">
                    <label class="property-label">Opacity</label>
                    <input type="range" class="property-input" id="brushOpacity" min="0" max="100" value="100">
                    <div style="text-align: center; margin-top: 5px; font-size: 12px; color: var(--text-secondary);">
                        <span id="brushOpacityValue">100</span>%
                    </div>
                </div>
            </div>

            <!-- Text Properties -->
            <div id="textProperties" style="display: none;">
                <div class="property-group">
                    <label class="property-label">Font Family</label>
                    <select class="property-input" id="fontFamily">
                        <option value="Arial">Arial</option>
                        <option value="Helvetica">Helvetica</option>
                        <option value="Georgia">Georgia</option>
                        <option value="Courier New">Courier New</option>
                        <option value="Verdana">Verdana</option>
                        <option value="Comic Sans MS">Comic Sans MS</option>
                    </select>
                </div>
                <div class="property-group">
                    <label class="property-label">Font Size</label>
                    <input type="number" class="property-input" id="fontSize" value="16" min="8" max="72">
                </div>
                <div class="property-group">
                    <label class="property-label">Text Color</label>
                    <input type="color" class="property-input" id="textColor" value="#c9d1d9">
                </div>
                <div class="property-group">
                    <label class="property-label">Formatting</label>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn" id="boldBtn" style="flex: 1; font-weight: bold;">B</button>
                        <button class="btn" id="italicBtn" style="flex: 1; font-style: italic;">I</button>
                        <button class="btn" id="underlineBtn" style="flex: 1; text-decoration: underline;">U</button>
                    </div>
                </div>
            </div>

            <!-- Shape Properties -->
            <div id="shapeProperties" style="display: none;">
                <div class="property-group">
                    <label class="property-label">Shape Type</label>
                    <select class="property-input" id="shapeType">
                        <option value="rectangle">Rectangle</option>
                        <option value="circle">Circle</option>
                        <option value="triangle">Triangle</option>
                        <option value="diamond">Diamond</option>
                        <option value="arrow">Arrow</option>
                        <option value="cloud">Cloud</option>
                    </select>
                </div>
                <div class="property-group">
                    <label class="property-label">Fill Color</label>
                    <input type="color" class="property-input" id="shapeFillColor" value="#58a6ff">
                </div>
                <div class="property-group">
                    <label class="property-label">Stroke Color</label>
                    <input type="color" class="property-input" id="shapeStrokeColor" value="#ffffff">
                </div>
                <div class="property-group">
                    <label class="property-label">Stroke Width</label>
                    <input type="range" class="property-input" id="shapeStrokeWidth" min="0" max="10" value="2">
                </div>
            </div>

            <!-- Code Properties -->
            <div id="codeProperties" style="display: none;">
                <div class="property-group">
                    <label class="property-label">Language</label>
                    <select class="property-input" id="codeLanguage">
                        <option value="javascript">JavaScript</option>
                        <option value="python">Python</option>
                        <option value="html">HTML</option>
                        <option value="css">CSS</option>
                        <option value="java">Java</option>
                        <option value="cpp">C++</option>
                    </select>
                </div>
                <div class="property-group">
                    <label class="property-label">Theme</label>
                    <select class="property-input" id="codeTheme">
                        <option value="dark">Dark</option>
                        <option value="light">Light</option>
                    </select>
                </div>
            </div>

            <!-- Element Properties -->
            <div id="elementProperties" style="display: none;">
                <div class="property-group">
                    <label class="property-label">Position</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                        <input type="number" class="property-input" id="posX" placeholder="X">
                        <input type="number" class="property-input" id="posY" placeholder="Y">
                    </div>
                </div>
                <div class="property-group">
                    <label class="property-label">Size</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                        <input type="number" class="property-input" id="width" placeholder="Width">
                        <input type="number" class="property-input" id="height" placeholder="Height">
                    </div>
                </div>
                <div class="property-group">
                    <label class="property-label">Layer Order</label>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn" id="bringToFrontBtn" style="flex: 1;">Bring to Front</button>
                        <button class="btn" id="sendToBackBtn" style="flex: 1;">Send to Back</button>
                    </div>
                </div>
                <div class="property-group">
                    <button class="btn" id="deleteElementBtn" style="width: 100%; background: var(--accent-danger);">
                        Delete Element
                    </button>
                </div>
            </div>
        </div>

        <!-- Status Bar -->
        <div class="status-bar">
            <div id="statusInfo">Ready</div>
            <div id="cursorPosition">X: 0, Y: 0</div>
        </div>

        <!-- Context Menu -->
        <div class="context-menu" id="contextMenu">
            <div class="context-menu-item" data-action="cut">Cut</div>
            <div class="context-menu-item" data-action="copy">Copy</div>
            <div class="context-menu-item" data-action="paste">Paste</div>
            <div class="context-menu-item" data-action="delete">Delete</div>
            <div class="context-menu-item" data-action="duplicate">Duplicate</div>
        </div>
    </div>

    <script>
        // Global State
        const state = {
            currentTool: 'select',
            currentProject: null,
            projects: {},
            canvas: {
                zoom: 1,
                panX: 0,
                panY: 0,
                elements: [],
                selectedElement: null,
                showGrid: true
            },
            history: {
                undoStack: [],
                redoStack: []
            },
            brushSettings: {
                color: '#ffffff',
                size: 3,
                opacity: 1
            },
            textSettings: {
                fontFamily: 'Arial',
                fontSize: 16,
                color: '#c9d1d9',
                bold: false,
                italic: false,
                underline: false
            },
            shapeSettings: {
                type: 'rectangle',
                fillColor: '#58a6ff',
                strokeColor: '#ffffff',
                strokeWidth: 2
            },
            codeSettings: {
                language: 'javascript',
                theme: 'dark'
            },
            isDrawing: false,
            isPanning: false,
            startPoint: null,
            currentPath: null
        };

        // DOM Elements
        const dom = {
            canvas: document.getElementById('canvas'),
            welcomeScreen: document.getElementById('welcomeScreen'),
            propertiesPanel: document.getElementById('propertiesPanel'),
            contextMenu: document.getElementById('contextMenu'),
            statusInfo: document.getElementById('statusInfo'),
            cursorPosition: document.getElementById('cursorPosition'),
            zoomLevel: document.getElementById('zoomLevel')
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initializeApp();
            setupEventListeners();
            setupKeyboardShortcuts();
            updateStatusBar('Ready to create');
        });

        function initializeApp() {
            // Set initial canvas position
            const container = document.querySelector('.canvas-container');
            
            // Center the canvas
            state.canvas.panX = (container.clientWidth - 5000) / 2;
            state.canvas.panY = (container.clientHeight - 5000) / 2;
            
            updateCanvasTransform();
            
            // Load projects from localStorage
            loadProjects();
        }

        function setupEventListeners() {
            // Tool buttons
            document.querySelectorAll('.tool-btn[data-tool]').forEach(btn => {
                btn.addEventListener('click', () => {
                    selectTool(btn.dataset.tool);
                });
            });

            // Canvas interactions
            dom.canvas.addEventListener('mousedown', handleCanvasMouseDown);
            dom.canvas.addEventListener('mousemove', handleCanvasMouseMove);
            dom.canvas.addEventListener('mouseup', handleCanvasMouseUp);
            dom.canvas.addEventListener('wheel', handleCanvasWheel);
            dom.canvas.addEventListener('contextmenu', handleContextMenu);
            
            // Zoom controls
            document.getElementById('zoomIn').addEventListener('click', () => zoom(1.2));
            document.getElementById('zoomOut').addEventListener('click', () => zoom(0.8));
            document.getElementById('zoomReset').addEventListener('click', () => resetZoom());

            // Project actions
            document.getElementById('newProjectBtn').addEventListener('click', showNewProjectModal);
            document.getElementById('saveProjectBtn').addEventListener('click', saveCurrentProject);
            document.getElementById('openProjectBtn').addEventListener('click', showProjectModal);
            document.getElementById('exportBtn').addEventListener('click', exportProject);

            // Grid toggle
            document.getElementById('gridToggle').addEventListener('click', toggleGrid);

            // Undo/Redo
            document.getElementById('undoBtn').addEventListener('click', undo);
            document.getElementById('redoBtn').addEventListener('click', redo);

            // Welcome screen
            document.getElementById('startBlankBtn').addEventListener('click', startBlankProject);
            document.getElementById('viewTemplatesBtn').addEventListener('click', toggleTemplatesView);

            // Properties panel
            setupPropertyListeners();

            // Context menu
            document.addEventListener('click', () => {
                dom.contextMenu.style.display = 'none';
            });
        }

        function setupPropertyListeners() {
            // Brush properties
            const brushSize = document.getElementById('brushSize');
            brushSize.addEventListener('input', (e) => {
                state.brushSettings.size = parseInt(e.target.value);
                document.getElementById('brushSizeValue').textContent = e.target.value;
            });

            const brushOpacity = document.getElementById('brushOpacity');
            brushOpacity.addEventListener('input', (e) => {
                state.brushSettings.opacity = parseInt(e.target.value) / 100;
                document.getElementById('brushOpacityValue').textContent = e.target.value;
            });

            // Color swatches
            document.querySelectorAll('.color-swatch').forEach(swatch => {
                swatch.addEventListener('click', () => {
                    document.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('active'));
                    swatch.classList.add('active');
                    state.brushSettings.color = swatch.dataset.color;
                });
            });

            // Text properties
            document.getElementById('fontFamily').addEventListener('change', (e) => {
                state.textSettings.fontFamily = e.target.value;
                updateSelectedTextElement();
            });

            document.getElementById('fontSize').addEventListener('input', (e) => {
                state.textSettings.fontSize = parseInt(e.target.value);
                updateSelectedTextElement();
            });

            document.getElementById('textColor').addEventListener('input', (e) => {
                state.textSettings.color = e.target.value;
                updateSelectedTextElement();
            });

            // Shape properties
            document.getElementById('shapeType').addEventListener('change', (e) => {
                state.shapeSettings.type = e.target.value;
                updateSelectedShapeElement();
            });

            document.getElementById('shapeFillColor').addEventListener('input', (e) => {
                state.shapeSettings.fillColor = e.target.value;
                updateSelectedShapeElement();
            });

            document.getElementById('shapeStrokeColor').addEventListener('input', (e) => {
                state.shapeSettings.strokeColor = e.target.value;
                updateSelectedShapeElement();
            });

            document.getElementById('shapeStrokeWidth').addEventListener('input', (e) => {
                state.shapeSettings.strokeWidth = parseInt(e.target.value);
                updateSelectedShapeElement();
            });

            // Code properties
            document.getElementById('codeLanguage').addEventListener('change', (e) => {
                state.codeSettings.language = e.target.value;
                updateSelectedCodeElement();
            });

            // Element actions
            document.getElementById('deleteElementBtn')?.addEventListener('click', deleteSelectedElement);
            document.getElementById('bringToFrontBtn')?.addEventListener('click', () => changeElementOrder('front'));
            document.getElementById('sendToBackBtn')?.addEventListener('click', () => changeElementOrder('back'));
        }

        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                // Tool shortcuts
                if (!e.ctrlKey && !e.metaKey) {
                    switch(e.key.toLowerCase()) {
                        case 'v': selectTool('select'); break;
                        case 'b': selectTool('brush'); break;
                        case 'e': selectTool('eraser'); break;
                        case 't': selectTool('text'); break;
                        case 's': selectTool('shape'); break;
                        case 'c': selectTool('connector'); break;
                        case 'k': selectTool('code'); break;
                    }
                }

                // Undo/Redo
                if ((e.ctrlKey || e.metaKey) && e.key === 'z' && !e.shiftKey) {
                    e.preventDefault();
                    undo();
                }
                if ((e.ctrlKey || e.metaKey) && (e.key === 'y' || (e.key === 'z' && e.shiftKey))) {
                    e.preventDefault();
                    redo();
                }

                // Delete
                if (e.key === 'Delete' || e.key === 'Backspace') {
                    if (state.canvas.selectedElement) {
                        e.preventDefault();
                        deleteSelectedElement();
                    }
                }

                // Save
                if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                    e.preventDefault();
                    saveCurrentProject();
                }
            });
        }

        function selectTool(tool) {
            state.currentTool = tool;
            
            // Update UI
            document.querySelectorAll('.tool-btn[data-tool]').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-tool="${tool}"]`).classList.add('active');
            
            // Update properties panel
            updatePropertiesPanel(tool);
            
            // Update cursor
            switch(tool) {
                case 'select':
                    dom.canvas.style.cursor = 'default';
                    break;
                case 'brush':
                case 'eraser':
                    dom.canvas.style.cursor = 'crosshair';
                    break;
                case 'text':
                    dom.canvas.style.cursor = 'text';
                    break;
                case 'shape':
                case 'connector':
                case 'code':
                    dom.canvas.style.cursor = 'crosshair';
                    break;
            }

            updateStatusBar(`${tool.charAt(0).toUpperCase() + tool.slice(1)} tool selected`);
        }

        function updatePropertiesPanel(tool) {
            // Hide all property panels
            document.getElementById('brushProperties').style.display = 'none';
            document.getElementById('textProperties').style.display = 'none';
            document.getElementById('shapeProperties').style.display = 'none';
            document.getElementById('codeProperties').style.display = 'none';
            document.getElementById('elementProperties').style.display = 'none';
            
            // Show relevant panel
            switch(tool) {
                case 'brush':
                case 'eraser':
                    document.getElementById('brushProperties').style.display = 'block';
                    break;
                case 'text':
                    document.getElementById('textProperties').style.display = 'block';
                    break;
                case 'shape':
                    document.getElementById('shapeProperties').style.display = 'block';
                    break;
                case 'code':
                    document.getElementById('codeProperties').style.display = 'block';
                    break;
            }
            
            // Show element properties if something is selected
            if (state.canvas.selectedElement) {
                document.getElementById('elementProperties').style.display = 'block';
            }
        }

        function handleCanvasMouseDown(e) {
            const rect = e.currentTarget.getBoundingClientRect();
            const x = (e.clientX - rect.left) / state.canvas.zoom - state.canvas.panX;
            const y = (e.clientY - rect.top) / state.canvas.zoom - state.canvas.panY;
            
            state.startPoint = { x, y };
            
            switch(state.currentTool) {
                case 'select':
                    handleSelectStart(x, y, e);
                    break;
                case 'brush':
                    startDrawing(x, y);
                    break;
                case 'eraser':
                    startErasing(x, y);
                    break;
                case 'text':
                    createTextElement(x, y);
                    break;
                case 'shape':
                    createShapeElement(x, y);
                    break;
                case 'code':
                    createCodeElement(x, y);
                    break;
            }
            
            // Middle mouse button for panning
            if (e.button === 1) {
                state.isPanning = true;
                e.currentTarget.style.cursor = 'grabbing';
            }
        }

        function handleCanvasMouseMove(e) {
            const rect = e.currentTarget.getBoundingClientRect();
            const x = (e.clientX - rect.left) / state.canvas.zoom - state.canvas.panX;
            const y = (e.clientY - rect.top) / state.canvas.zoom - state.canvas.panY;
            
            // Update cursor position in status bar
            dom.cursorPosition.textContent = `X: ${Math.round(x)}, Y: ${Math.round(y)}`;
            
            if (state.isPanning && state.startPoint) {
                const dx = x - state.startPoint.x;
                const dy = y - state.startPoint.y;
                state.canvas.panX += dx;
                state.canvas.panY += dy;
                updateCanvasTransform();
                return;
            }
            
            if (state.isDrawing && state.currentPath) {
                if (state.currentTool === 'brush') {
                    drawLine(state.startPoint.x, state.startPoint.y, x, y);
                } else if (state.currentTool === 'eraser') {
                    eraseLine(state.startPoint.x, state.startPoint.y, x, y);
                }
                state.startPoint = { x, y };
            }
        }

        function handleCanvasMouseUp(e) {
            if (state.isDrawing) {
                state.isDrawing = false;
                if (state.currentPath) {
                    saveToHistory();
                    state.currentPath = null;
                }
            }
            
            if (state.isPanning) {
                state.isPanning = false;
                dom.canvas.style.cursor = getCursorForTool(state.currentTool);
            }
            
            state.startPoint = null;
        }

        function handleCanvasWheel(e) {
            e.preventDefault();
            const delta = e.deltaY > 0 ? 0.9 : 1.1;
            zoom(delta, e.clientX, e.clientY);
        }

        function handleContextMenu(e) {
            e.preventDefault();
            const rect = e.currentTarget.getBoundingClientRect();
            const x = e.clientX;
            const y = e.clientY;
            
            dom.contextMenu.style.display = 'block';
            dom.contextMenu.style.left = `${x}px`;
            dom.contextMenu.style.top = `${y}px`;
            
            return false;
        }

        function zoom(factor, centerX, centerY) {
            const prevZoom = state.canvas.zoom;
            state.canvas.zoom = Math.max(0.1, Math.min(5, state.canvas.zoom * factor));
            
            if (centerX !== undefined && centerY !== undefined) {
                const rect = dom.canvas.getBoundingClientRect();
                const x = (centerX - rect.left) / prevZoom;
                const y = (centerY - rect.top) / prevZoom;
                
                state.canvas.panX -= x * (state.canvas.zoom - prevZoom);
                state.canvas.panY -= y * (state.canvas.zoom - prevZoom);
            }
            
            updateCanvasTransform();
            dom.zoomLevel.textContent = `${Math.round(state.canvas.zoom * 100)}%`;
        }

        function resetZoom() {
            state.canvas.zoom = 1;
            state.canvas.panX = 0;
            state.canvas.panY = 0;
            updateCanvasTransform();
            dom.zoomLevel.textContent = '100%';
        }

        function updateCanvasTransform() {
            dom.canvas.style.transform = `translate(${state.canvas.panX}px, ${state.canvas.panY}px) scale(${state.canvas.zoom})`;
        }

        function startDrawing(x, y) {
            state.isDrawing = true;
            const path = {
                type: 'path',
                points: [{x, y}],
                color: state.brushSettings.color,
                width: state.brushSettings.size,
                opacity: state.brushSettings.opacity,
                id: Date.now().toString()
            };
            
            state.canvas.elements.push(path);
            state.currentPath = path;
            renderCanvas();
        }

        function drawLine(x1, y1, x2, y2) {
            if (!state.isDrawing || !state.currentPath) return;
            
            state.currentPath.points.push({x: x2, y: y2});
            renderCanvas();
        }

        function createTextElement(x, y) {
            const text = {
                type: 'text',
                x,
                y,
                width: 200,
                height: 100,
                content: 'Double click to edit',
                fontFamily: state.textSettings.fontFamily,
                fontSize: state.textSettings.fontSize,
                color: state.textSettings.color,
                bold: state.textSettings.bold,
                italic: state.textSettings.italic,
                underline: state.textSettings.underline,
                id: Date.now().toString()
            };
            
            state.canvas.elements.push(text);
            renderCanvas();
            selectElement(text);
            
            // Focus on the new text element
            setTimeout(() => {
                const textEl = document.getElementById(`text-${text.id}`);
                if (textEl) {
                    textEl.focus();
                    textEl.select();
                }
            }, 100);
            
            saveToHistory();
        }

        function createShapeElement(x, y) {
            const shape = {
                type: 'shape',
                shapeType: state.shapeSettings.type,
                x,
                y,
                width: 100,
                height: 100,
                fillColor: state.shapeSettings.fillColor,
                strokeColor: state.shapeSettings.strokeColor,
                strokeWidth: state.shapeSettings.strokeWidth,
                id: Date.now().toString()
            };
            
            state.canvas.elements.push(shape);
            renderCanvas();
            selectElement(shape);
            saveToHistory();
        }

        function createCodeElement(x, y) {
            const code = {
                type: 'code',
                x,
                y,
                width: 300,
                height: 200,
                content: getDefaultCode(state.codeSettings.language),
                language: state.codeSettings.language,
                theme: state.codeSettings.theme,
                id: Date.now().toString()
            };
            
            state.canvas.elements.push(code);
            renderCanvas();
            selectElement(code);
            saveToHistory();
        }

        function getDefaultCode(language) {
            const defaults = {
                javascript: 'function hello() {\n  console.log("Hello, CodeCanvas!");\n}',
                python: 'def hello():\n    print("Hello, CodeCanvas!")\n\nhello()',
                html: '<!DOCTYPE html>\n<html>\n<head>\n    <title>Hello</title>\n</head>\n<body>\n    <h1>Hello, CodeCanvas!</h1>\n</body>\n</html>',
                css: 'body {\n    font-family: Arial, sans-serif;\n    background-color: #1e1e1e;\n    color: #e8e8e8;\n}',
                java: 'public class Hello {\n    public static void main(String[] args) {\n        System.out.println("Hello, CodeCanvas!");\n    }\n}',
                cpp: '#include <iostream>\n\nint main() {\n    std::cout << "Hello, CodeCanvas!" << std::endl;\n    return 0;\n}'
            };
            
            return defaults[language] || '// Start coding here';
        }

        function handleSelectStart(x, y, e) {
            // Clear previous selection
            if (state.canvas.selectedElement) {
                const selectedEl = document.getElementById(`element-${state.canvas.selectedElement.id}`);
                if (selectedEl) {
                    selectedEl.classList.remove('selected');
                }
                state.canvas.selectedElement = null;
            }
            
            // Find element at position
            for (let i = state.canvas.elements.length - 1; i >= 0; i--) {
                const element = state.canvas.elements[i];
                if (isPointInElement(x, y, element)) {
                    selectElement(element);
                    return;
                }
            }
        }

        function isPointInElement(x, y, element) {
            return x >= element.x && x <= element.x + element.width &&
                   y >= element.y && y <= element.y + element.height;
        }

        function selectElement(element) {
            state.canvas.selectedElement = element;
            const elementEl = document.getElementById(`element-${element.id}`);
            if (elementEl) {
                elementEl.classList.add('selected');
            }
            
            // Update properties panel
            updatePropertiesPanel(state.currentTool);
            document.getElementById('elementProperties').style.display = 'block';
            
            // Update position and size inputs
            document.getElementById('posX').value = Math.round(element.x);
            document.getElementById('posY').value = Math.round(element.y);
            document.getElementById('width').value = Math.round(element.width);
            document.getElementById('height').value = Math.round(element.height);
        }

        function renderCanvas() {
            // Clear the canvas
            dom.canvas.innerHTML = '';
            
            // Render all elements
            state.canvas.elements.forEach(element => {
                const elementEl = createElementElement(element);
                dom.canvas.appendChild(elementEl);
            });
        }

        function createElementElement(element) {
            const el = document.createElement('div');
            el.id = `element-${element.id}`;
            el.className = 'canvas-element';
            el.style.left = `${element.x}px`;
            el.style.top = `${element.y}px`;
            el.style.width = `${element.width}px`;
            el.style.height = `${element.height}px`;
            
            switch(element.type) {
                case 'text':
                    el.innerHTML = `
                        <textarea class="text-element" style="
                            font-family: ${element.fontFamily};
                            font-size: ${element.fontSize}px;
                            color: ${element.color};
                            font-weight: ${element.bold ? 'bold' : 'normal'};
                            font-style: ${element.italic ? 'italic' : 'normal'};
                            text-decoration: ${element.underline ? 'underline' : 'none'};
                        ">${element.content}</textarea>
                    `;
                    break;
                case 'shape':
                    el.innerHTML = `
                        <div class="shape-element" style="
                            width: 100%;
                            height: 100%;
                            background-color: ${element.fillColor};
                            border: ${element.strokeWidth}px solid ${element.strokeColor};
                            ${element.shapeType === 'circle' ? 'border-radius: 50%;' : ''}
                            ${element.shapeType === 'triangle' ? 'clip-path: polygon(50% 0%, 0% 100%, 100% 100%);' : ''}
                            ${element.shapeType === 'diamond' ? 'clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);' : ''}
                        "></div>
                    `;
                    break;
                case 'code':
                    el.innerHTML = `
                        <pre class="code-element" style="font-size: 13px;">${element.content}</pre>
                    `;
                    break;
                case 'path':
                    // For simplicity, we'll represent paths as SVG
                    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                    svg.setAttribute('width', '100%');
                    svg.setAttribute('height', '100%');
                    svg.style.position = 'absolute';
                    svg.style.top = '0';
                    svg.style.left = '0';
                    
                    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    let d = '';
                    element.points.forEach((point, i) => {
                        if (i === 0) {
                            d += `M ${point.x} ${point.y} `;
                        } else {
                            d += `L ${point.x} ${point.y} `;
                        }
                    });
                    path.setAttribute('d', d);
                    path.setAttribute('stroke', element.color);
                    path.setAttribute('stroke-width', element.width);
                    path.setAttribute('fill', 'none');
                    path.setAttribute('stroke-linecap', 'round');
                    path.setAttribute('stroke-linejoin', 'round');
                    path.setAttribute('opacity', element.opacity);
                    
                    svg.appendChild(path);
                    el.appendChild(svg);
                    break;
            }
            
            return el;
        }

        function updateSelectedTextElement() {
            if (!state.canvas.selectedElement || state.canvas.selectedElement.type !== 'text') return;
            
            const element = state.canvas.selectedElement;
            element.fontFamily = state.textSettings.fontFamily;
            element.fontSize = state.textSettings.fontSize;
            element.color = state.textSettings.color;
            element.bold = state.textSettings.bold;
            element.italic = state.textSettings.italic;
            element.underline = state.textSettings.underline;
            
            renderCanvas();
            selectElement(element);
        }

        function updateSelectedShapeElement() {
            if (!state.canvas.selectedElement || state.canvas.selectedElement.type !== 'shape') return;
            
            const element = state.canvas.selectedElement;
            element.shapeType = state.shapeSettings.type;
            element.fillColor = state.shapeSettings.fillColor;
            element.strokeColor = state.shapeSettings.strokeColor;
            element.strokeWidth = state.shapeSettings.strokeWidth;
            
            renderCanvas();
            selectElement(element);
        }

        function updateSelectedCodeElement() {
            if (!state.canvas.selectedElement || state.canvas.selectedElement.type !== 'code') return;
            
            const element = state.canvas.selectedElement;
            element.language = state.codeSettings.language;
            element.theme = state.codeSettings.theme;
            
            renderCanvas();
            selectElement(element);
        }

        function deleteSelectedElement() {
            if (!state.canvas.selectedElement) return;
            
            const index = state.canvas.elements.findIndex(el => el.id === state.canvas.selectedElement.id);
            if (index !== -1) {
                state.canvas.elements.splice(index, 1);
                state.canvas.selectedElement = null;
                renderCanvas();
                saveToHistory();
            }
        }

        function changeElementOrder(order) {
            if (!state.canvas.selectedElement) return;
            
            const index = state.canvas.elements.findIndex(el => el.id === state.canvas.selectedElement.id);
            if (index !== -1) {
                const element = state.canvas.elements.splice(index, 1)[0];
                
                if (order === 'front') {
                    state.canvas.elements.push(element);
                } else {
                    state.canvas.elements.unshift(element);
                }
                
                renderCanvas();
                selectElement(element);
                saveToHistory();
            }
        }

        function saveToHistory() {
            // Save current state to history
            state.history.undoStack.push(JSON.stringify(state.canvas.elements));
            state.history.redoStack = [];
            
            // Limit undo stack size
            if (state.history.undoStack.length > 50) {
                state.history.undoStack.shift();
            }
        }

        function undo() {
            if (state.history.undoStack.length === 0) return;
            
            // Save current state to redo stack
            state.history.redoStack.push(JSON.stringify(state.canvas.elements));
            
            // Restore previous state
            const previousState = state.history.undoStack.pop();
            state.canvas.elements = JSON.parse(previousState);
            
            renderCanvas();
            updateStatusBar('Undo completed');
        }

        function redo() {
            if (state.history.redoStack.length === 0) return;
            
            // Save current state to undo stack
            state.history.undoStack.push(JSON.stringify(state.canvas.elements));
            
            // Restore next state
            const nextState = state.history.redoStack.pop();
            state.canvas.elements = JSON.parse(nextState);
            
            renderCanvas();
            updateStatusBar('Redo completed');
        }

        function toggleGrid() {
            state.canvas.showGrid = !state.canvas.showGrid;
            if (state.canvas.showGrid) {
                dom.canvas.classList.remove('no-grid');
            } else {
                dom.canvas.classList.add('no-grid');
            }
            updateStatusBar(`Grid ${state.canvas.showGrid ? 'enabled' : 'disabled'}`);
        }

        function startBlankProject() {
            dom.welcomeScreen.style.display = 'none';
            state.canvas.elements = [];
            renderCanvas();
            updateStatusBar('New project started');
        }

        function toggleTemplatesView() {
            const templateGrid = document.getElementById('templateGrid');
            if (templateGrid.style.display === 'none') {
                templateGrid.style.display = 'grid';
                document.getElementById('viewTemplatesBtn').textContent = 'Hide Templates';
            } else {
                templateGrid.style.display = 'none';
                document.getElementById('viewTemplatesBtn').textContent = 'View Templates';
            }
        }

        function createNewProject(name) {
            state.currentProject = {
                id: Date.now().toString(),
                name: name || 'Untitled Project',
                createdAt: new Date().toISOString(),
                elements: []
            };
            
            state.canvas.elements = [];
            renderCanvas();
            updateStatusBar(`Project "${state.currentProject.name}" created`);
        }

        function saveCurrentProject() {
            if (!state.currentProject) {
                const projectName = prompt('Enter project name:', 'Untitled Project');
                if (!projectName) return;
                
                state.currentProject = {
                    id: Date.now().toString(),
                    name: projectName,
                    createdAt: new Date().toISOString(),
                    elements: state.canvas.elements
                };
            } else {
                state.currentProject.elements = state.canvas.elements;
            }
            
            // Save to localStorage
            state.projects[state.currentProject.id] = state.currentProject;
            localStorage.setItem('codeCanvas_projects', JSON.stringify(state.projects));
            
            updateStatusBar(`Project "${state.currentProject.name}" saved`);
        }

        function loadProjects() {
            const projectsData = localStorage.getItem('codeCanvas_projects');
            if (projectsData) {
                state.projects = JSON.parse(projectsData);
            }
        }

        function showProjectModal() {
            // Implementation for project modal
            alert('Project manager would show here with list of saved projects');
        }

        function exportProject() {
            // Implementation for export
            alert('Export functionality would be implemented here');
        }

        function updateStatusBar(message) {
            dom.statusInfo.textContent = message;
        }

        function getCursorForTool(tool) {
            switch(tool) {
                case 'select': return 'default';
                case 'brush': return 'crosshair';
                case 'eraser': return 'crosshair';
                case 'text': return 'text';
                case 'shape': return 'crosshair';
                case 'connector': return 'crosshair';
                case 'code': return 'crosshair';
                default: return 'default';
            }
        }
    </script>
</body>
</html>
